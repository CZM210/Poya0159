<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨åœ‹æ‰¿ç§Ÿå±•ç¤ºç³»çµ±</title>
    <style>
        body { background-color: #f4f7f6; font-family: "Microsoft JhengHei", Arial; font-size: 14px; margin: 0; padding: 15px; }
        .container { max-width: 800px; margin: 0 auto; }
        .item-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 12px; border-left: 6px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: flex-start; }
        .status-new { border-left-color: #007bff; background-color: #f0f7ff; }
        .status-remove { border-left-color: #dc3545; background-color: #fff8f8; }
        .info-area { flex: 1; padding-right: 10px; }
        .item-title { font-weight: bold; font-size: 1.1rem; color: #222; display: block; margin-bottom: 5px; }
        .sticky-header { position: sticky; top: 0; background: #f4f7f6; padding: 10px 0; z-index: 100; border-bottom: 1px solid #ddd; margin-bottom: 15px; }
        .form-control { width: 100%; padding: 10px; margin-bottom: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 16px; }
        .badge { display: inline-block; padding: 3px 8px; color: white; border-radius: 4px; font-size: 12px; margin-bottom: 5px; }
        .bg-primary { background-color: #007bff; }
        .bg-danger { background-color: #dc3545; }
        .bg-secondary { background-color: #6c757d; }
        .img-area { flex: 0 0 100px; text-align: right; position: relative; padding-top: 5px; }
        .item-img { width: 100px; height: 100px; object-fit: contain; border: 1px solid #eee; border-radius: 8px; display: none; background: white; }
        .img-x { position: absolute; top: -5px; right: -5px; background: #dc3545; color: white; width: 20px; height: 20px; border-radius: 50%; text-align: center; line-height: 20px; font-weight: bold; font-size: 12px; border: 2px solid white; z-index: 5; }
    </style>
</head>
<body>
<div class="container">
    <div class="sticky-header">
        <h2 style="text-align:center; margin:0 0 10px 0;">ğŸª å…¨åœ‹æ‰¿ç§Ÿç³»çµ±</h2>
        <select id="f-store" class="form-control" onchange="loadStoreDetail()">
            <option value="">--- è«‹é¸æ“‡åˆ†åº— (å…± 75 é–“) ---</option><option value="100">100 å¯¶é›…å°ä¸­é»æ˜åº—</option><option value="103">103 å¯¶é›…å°ä¸­æ±å‹¢åº—</option><option value="128">128 å¯¶é›…æ²™é¹¿å…‰è¯åº—</option><option value="129">129 å¯¶é›…è±åŸå‘é™½åº—</option><option value="136">136 å¯¶é›…å°ä¸­æ²³å—åº—</option><option value="137">137 å¯¶é›…å¤§ç”²è‚²å¾·åº—</option><option value="15">15 å¯¶é›…å°ä¸­ä¸€ä¸­åº—</option><option value="158">158 å¯¶é›…å°ä¸­åŒ—å±¯åº—</option><option value="159">159 å¯¶é›…æ–‡å¿ƒå±±è¥¿åº—</option><option value="16">16 å¯¶é›…å°ä¸­æ–‡å¿ƒåº—</option><option value="169">169 å¯¶é›…å¤§é‡Œåœ‹å…‰åº—</option><option value="179">179 å¯¶é›…å°ä¸­å¤§é‡Œåº—</option><option value="186">186 å¯¶é›…é€¢ç”²ç¦æ˜Ÿåº—</option><option value="191">191 å¯¶é›…å°ä¸­å¶ºæ±åº—</option><option value="200">200 å¯¶é›…å°ä¸­çƒæ—¥åº—</option><option value="202">202 å¯¶é›…å°ä¸­ç¥å²¡åº—</option><option value="207">207 å¯¶é›…å°ä¸­å¤ªå¹³åº—</option><option value="209">209 å¯¶é›…å°ä¸­ä¸­æ¸…åº—</option><option value="210">210 å¯¶é›…å°ä¸­æ¸…æ°´åº—</option><option value="212">212 å¯¶é›…å°ä¸­å¤§è‚šåº—</option><option value="215">215 å¯¶é›…æ²™é¹¿é®å—åº—</option><option value="216">216 å¯¶é›…åŒ—å±¯æ±å±±åº—</option><option value="218">218 å¯¶é›…å°ä¸­å¤§é­¯é–£åº—</option><option value="220">220 å¯¶é›…å°ä¸­åé‡Œåº—</option><option value="230">230 å¯¶é›…å°ä¸­å…¬ç›Šåº—</option><option value="237">237 å¯¶é›…æ„›è²·å¾©èˆˆåº—</option><option value="243">243 å¯¶é›…ç§€æ³°æ–‡å¿ƒåº—</option><option value="244">244 å¯¶é›…éº—å¯¶æ¨‚åœ’åº—</option><option value="248">248 å¯¶é›…è±åŸæˆåŠŸåº—</option><option value="255">255 å¯¶é›…å°ä¸­ç¦ç§‘åº—</option><option value="261">261 å¯¶é›…å°ä¸­ä¸­æ­£åº—</option><option value="262">262 å¯¶é›…å¤ªå¹³æ¨¹å­åº—</option><option value="271">271 å¯¶é›…ç§€æ³°ç«™å‰åº—</option><option value="312">312 å¯¶é›…å°ä¸­é‡‘å…¸åº—</option><option value="314">314 å¯¶é›…å¤§ç”²è”£å…¬åº—</option><option value="323">323 å¯¶é›…åŒ—å±¯èˆŠç¤¾åº—</option><option value="341">341 å¯¶é›…å°ä¸­å‘å¿ƒåº—</option><option value="351">351 å¯¶é›…æ²™é¹¿è‹±æ‰åº—</option><option value="355">355 å¯¶é›…å°ä¸­æ¼¢å£äºŒåº—</option><option value="356">356 å¯¶é›…å°ä¸­æ¼¢å£ä¸‰åº—</option><option value="357">357 å¯¶é›…å°ä¸­å¿ å­åº—</option><option value="358">358 å¯¶é›…å¤ªå¹³ç’°ä¸­ä¸€åº—</option><option value="36">36 å¯¶é›…å°ä¸­å¤§å¢©åº—</option><option value="361">361 å¯¶é›…å°ä¸­è‡ªç”±åº—</option><option value="362">362 å¯¶é›…é¾äº•æ–°èˆˆåº—</option><option value="367">367 å¯¶é›…å¤§é›…ä¸­æ¸…äºŒåº—</option><option value="373">373 å¯¶é›…å°ä¸­æ²³å—äºŒåº—</option><option value="374">374 å¯¶é›…æ²™é¹¿å‘ä¸Šåº—</option><option value="391">391 å¯¶é›…æ„›è²·è±åŸåº—</option><option value="396">396 å¯¶é›…å°ä¸­å´‡å¾·åº—</option><option value="405">405 å¯¶é›…å°ä¸­å¸‚æ”¿åº—</option><option value="41">41 å¯¶é›…è±åŸåºœå‰åº—</option><option value="411">411 å¯¶é›…å°ä¸­å¤§é­¯é–£äºŒåº—</option><option value="418">418 å¯¶é›…è±åŸä¸­æ­£åº—</option><option value="424">424 å¯¶é›…éœ§å³°ä¸­æ­£äºŒåº—</option><option value="429">429 å¯¶é›…å°ä¸­å´‡å¾·äºŒåº—</option><option value="432">432 å¯¶é›…å°ä¸­ä¸­æ¸…äºŒåº—</option><option value="440">440 å¯¶é›…æ½­å­ç¦æ½­åº—</option><option value="441">441 å¯¶é›…å¤§é‡Œä¸­èˆˆäºŒåº—</option><option value="450">450 å¯¶é›…å°ä¸­æ–‡å¿ƒå—åº—</option><option value="464">464 å¯¶é›…å°ä¸­è»åŠŸåº—</option><option value="466">466 å¯¶é›…åŒ—å±¯æ±å±±äºŒåº—</option><option value="47">47 å¯¶é›…å°ä¸­å­¸å£«åº—</option><option value="481">481 å¯¶é›…å°ä¸­ç±³å¹³æ–¹åº—</option><option value="483">483 å¯¶é›…æ½­å­ä¸­å±±åº—</option><option value="484">484 å¯¶é›…å°ä¸­æ–‡å¿ƒäºŒåº—</option><option value="500">500 å¯¶é›…å¤§ç”²ç¶“åœ‹åº—</option><option value="506">506 å¯¶é›…å¤ªå¹³ä¸­èˆˆæ±åº—</option><option value="62">62 å¯¶é›…å°ä¸­æ½­å­åº—</option><option value="71">71 å¯¶é›…å°ä¸­ç¾æ‘å—åº—</option><option value="73">73 å¯¶é›…å¤§é›…ä¸­æ¸…åº—</option><option value="78">78 å¯¶é›…å°ä¸­éœ§å³°åº—</option><option value="89">89 å¯¶é›…å°ä¸­ç²¾æ­¦æ±åº—</option><option value="94">94 å¯¶é›…å¤§é‡ŒæˆåŠŸåº—</option><option value="95">95 å¯¶é›…å°ä¸­æ¾ç«¹åº—</option>
        </select>
        <div id="loading-hint" style="display:none; text-align:center; color:#007bff; font-weight:bold;">â³ è®€å–è³‡æ–™ä¸­...</div>
        <div id="filter-group" style="display:none;">
            <select id="f-dept" class="form-control" onchange="render()"></select>
            <select id="f-item" class="form-control" onchange="render()"></select>
            <input type="text" id="f-search" class="form-control" placeholder="å¿«é€Ÿæœå°‹..." onkeyup="render()">
        </div>
    </div>
    <div id="card-container"></div>
</div>

<script>
    var currentData = [];

    function loadStoreDetail() {
        var sid = document.getElementById('f-store').value;
        if (!sid) {
            document.getElementById('filter-group').style.display = 'none';
            document.getElementById('card-container').innerHTML = '';
            return;
        }
        
        document.getElementById('loading-hint').style.display = 'block';
        
        var xhr = new XMLHttpRequest();
        xhr.open('GET', './data/' + sid + '.json?v=' + new Date().getTime(), true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                currentData = JSON.parse(xhr.responseText);
                document.getElementById('loading-hint').style.display = 'none';
                document.getElementById('filter-group').style.display = 'block';
                
                setupFilters();
                render();
            }
        };
        xhr.send();
    }

    function setupFilters() {
        var depts = []; var items = [];
        for (var i = 0; i < currentData.length; i++) {
            var d = currentData[i];
            if (d.éƒ¨é–€ && depts.indexOf(d.éƒ¨é–€) === -1) depts.push(d.éƒ¨é–€);
            if (d.é …ç›® && items.indexOf(d.é …ç›®) === -1) items.push(d.é …ç›®);
        }
        depts.sort(); items.sort();

        var dH = '<option value="">-- å…¨éƒ¨éƒ¨é–€ --</option>';
        for (var j = 0; j < depts.length; j++) dH += '<option value="' + depts[j] + '">' + depts[j] + '</option>';
        dH += '<option value="FN">â­ åªçœ‹æ–°å¢</option><option value="FR">âŒ åªçœ‹ç§»é™¤</option>';
        document.getElementById('f-dept').innerHTML = dH;

        var iH = '<option value="">-- æ‰€æœ‰é …ç›® --</option>';
        for (var k = 0; k < items.length; k++) iH += '<option value="' + items[k] + '">' + items[k] + '</option>';
        document.getElementById('f-item').innerHTML = iH;
    }

    function render() {
        var dVal = document.getElementById('f-dept').value;
        var iVal = document.getElementById('f-item').value;
        var sVal = document.getElementById('f-search').value.toLowerCase();
        var html = '';

        for (var i = 0; i < currentData.length; i++) {
            var d = currentData[i];
            var mDept = (dVal === "FN") ? (d.æ¯”å°çµæœ === "æ–°å¢") :
                        (dVal === "FR") ? (d.æ¯”å°çµæœ === "ç§»é™¤") :
                        (dVal === "" || d.éƒ¨é–€ === dVal);
            var mItem = (iVal === "" || d.é …ç›® === iVal);
            var mSearch = ((d.æ‰¿ç§Ÿé …ç›® || "") + (d.å» å•†åç¨± || "") + (d.å» ç·¨ || "")).toLowerCase().indexOf(sVal) !== -1;

            if (mDept && mItem && mSearch) {
                var isNew = (d.æ¯”å°çµæœ === "æ–°å¢");
                var isRem = (d.æ¯”å°çµæœ === "ç§»é™¤");
                var css = isNew ? "status-new" : (isRem ? "status-remove" : "");
                var bC = isNew ? "bg-primary" : (isRem ? "bg-danger" : "bg-secondary");
                
                html += '<div class="item-card ' + css + '">';
                html += '  <div class="info-area">';
                html += '    <span class="badge ' + bC + '">' + (d.æ¯”å°çµæœ || "ç„¡") + '</span>';
                html += '    <span class="item-title">' + (isNew ? "â­ " : (isRem ? "ğŸš« " : "")) + d.æ‰¿ç§Ÿé …ç›® + '</span>';
                html += '    <div style="color:#666;">' + d.éƒ¨é–€ + ' | ' + d.é …ç›® + '</div>';
                html += '    <div>å» å•†: ' + d.å» å•†åç¨± + ' (' + d.å» ç·¨ + ')</div>';
                html += '    <div style="font-size:0.8rem; color:#999; margin-top:4px;">' + d.æª”æœŸ + '</div>';
                html += '  </div>';

                if (d.img_id) {
                    html += '<div class="img-area">';
                    if (isRem) html += '<div class="img-x">âœ•</div>';
                    html += '  <img src="photos/' + d.img_id + '.jpg" class="item-img" onload="this.style.display=\'inline-block\'" onerror="this.style.display=\'none\'">';
                    html += '</div>';
                }
                html += '</div>';
            }
        }
        document.getElementById('card-container').innerHTML = html || '<p style="text-align:center;color:#999;">æŸ¥ç„¡è³‡æ–™</p>';
    }
</script>
</body>
</html>